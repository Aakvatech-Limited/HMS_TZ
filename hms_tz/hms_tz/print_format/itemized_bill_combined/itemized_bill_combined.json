{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2021-04-03 14:48:32.049270",
 "css": ".print-format {\r\n    font-size: 10pt;\r\n    padding: 0.5in;\r\n}\r\n\r\n.print-heading {\r\n    text-align: center;\r\n    padding-bottom: 5px;\r\n}\r\n\r\nhr {\r\n    margin-top: 10px;\r\n    margin-bottom: 5px;\r\n}\r\n\r\ntable {\r\n    font-size: 11px;\r\n}\r\n\r\n.print-format td, .print-format th {\r\n    padding: 2px !important;\r\n}\r\n\r\n@media print {\r\n    #footer-html {\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n}",
 "custom_format": 0,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Patient Appointment",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "format_data": "[{\"fieldname\": \"print_heading_template\", \"fieldtype\": \"Custom HTML\", \"options\": \"<hr>\\n<div class=\\\"print-heading\\\">\\n    <h2 class=\\\"text-center\\\">Itemized Bill</h2>\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Patient Information\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"patient\", \"print_hide\": 0, \"label\": \"Patient\"}, {\"fieldname\": \"patient_name\", \"print_hide\": 0, \"label\": \"Patient Name\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"appointment_type\", \"print_hide\": 0, \"label\": \"Appointment Type\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Appointment Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n        {{ frappe.utils.get_datetime(doc.appointment_date).strftime('%d-%b-%Y')  }}\\r\\n\\t</div>\\r\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Insurance or Company Information\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"insurance_company\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Insurance\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"authorization_number\", \"print_hide\": 0, \"align\": \"left\", \"label\": \"Authorization No\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Admission Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n        {{ frappe.utils.get_datetime(frappe.db.get_value('Inpatient Record', inpatient_id, 'admitted_datetime')).strftime('%d-%b-%Y')  }}\\r\\n\\t</div>\\r\\n</div>\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Admission Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n        {{ frappe.utils.get_datetime(frappe.db.get_value('Inpatient Record', inpatient_id, 'discharge_date')).strftime('%d-%b-%Y')  }}\\r\\n\\t</div>\\r\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% if doc.mode_of_payment %}\\r\\n\\t{% set bill = [] %}\\r\\n\\t\\t{% set consultancy = frappe.db.get_all('Sales Invoice Item', {'reference_dn': doc.name}, ['parent', 'item_code','item_name','qty','uom','rate','amount']) %}\\r\\n\\t\\t{% for item in consultancy %}\\r\\n\\t\\t\\t{% set item_date = frappe.db.get_value('Sales Invoice', item.parent, 'posting_date') %}\\r\\n\\t\\t\\t{% set item_category = frappe.db.get_value('Item', item.item_name, 'item_group') %}\\r\\n\\t\\t\\t{% set _ = item.update({\\\"date\\\": item_date, \\\"category\\\": item_category }) %}\\r\\n\\t\\t\\t{% set bill = bill.append(item) %}\\t\\t\\r\\n\\t\\t{% endfor %}\\r\\n\\t\\t\\r\\n\\t\\t{% set encouter_list = frappe.db.get_all(\\\"Patient Encounter\\\", {'appointment' : doc.name }, ['name']) %}\\r\\n\\t\\t{% set encouter_string =  (encouter_list[:encouter_list|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n\\t\\t{% set hsos = frappe.db.get_all(\\\"Healthcare Service Order\\\", filters={'order_group': ['in', encouter_string]}, fields=['name'], order_by='creation desc') %}\\r\\n\\t\\t{% set hsos_string  = (hsos[:hsos|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n\\t\\t{% set invoice_items = frappe.db.get_all(\\\"Sales Invoice Item\\\", filters={'docstatus': 1, 'reference_dn': ['in', hsos_string]}, fields=['parent', 'item_code','item_name','qty','uom','rate','amount'], order_by='modified asc') %}    \\r\\n\\t\\t{% for item in invoice_items %}\\r\\n\\t\\t\\t{% set item_date = frappe.db.get_value('Sales Invoice', item.parent, 'posting_date') %}\\r\\n\\t\\t\\t{% set item_category = frappe.db.get_value('Item', item.item_name, 'item_group') %}\\r\\n\\t\\t\\t{% set _ = item.update({\\\"date\\\": item_date, \\\"category\\\": item_category }) %}\\r\\n\\t\\t\\t{% set bill = bill.append(item) %}\\r\\n\\t\\t{% endfor %}\\r\\n\\r\\n\\t\\t{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n\\t\\t\\r\\n\\t\\t{% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'invoiced': 1, 'parent': inpatient_id}, fields=['check_in', 'service_unit'], order_by='check_in asc') %}    \\r\\n\\t\\t{% for item in bed_charges %}\\r\\n\\t\\t\\t{% set hsu = frappe.db.get_value('Healthcare Service Unit', item.service_unit, 'service_unit_type') %}\\r\\n\\t\\t\\t{% set item_category = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'item_group') %}\\r\\n\\t\\t\\t{% set item_uom = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'uom') %}\\r\\n\\t\\t\\t{% set price_list = frappe.db.get_value('Mode of Payment', doc.mode_of_payment, 'price_list') %}\\t\\t\\r\\n\\t\\t\\t{% set item_rate = frappe.db.get_value('Item Price', {'item_code' : hsu, 'price_list': price_list}, 'price_list_rate') %}\\r\\n\\t\\t\\t{% set _ = item.update({\\\"item_name\\\": item.service_unit, \\\"date\\\": item.check_in, \\\"category\\\": item_category, \\\"qty\\\": 1, \\\"rate\\\": item_rate, \\\"uom\\\": item_uom, \\\"amount\\\": item_rate  }) %}\\r\\n\\t\\t\\t{% set bill = bill.append(item) %}\\r\\n\\t\\t{% endfor %}\\r\\n\\t\\t\\r\\n\\t\\t{% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'parent': inpatient_id}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\r\\n\\t\\t\\r\\n\\t\\t{% for item in ipd_cons %}\\r\\n\\t\\t\\t{% set item_category = frappe.db.get_value('Item', item.consultation_item, 'item_group') %}\\r\\n\\t\\t\\t{% set item_uom = frappe.db.get_value('Item', item.consultation_item, 'stock_uom') %}\\r\\n\\t\\t\\t{% set _ = item.update({\\\"item_name\\\": item.consultation_item, \\\"category\\\": item_category, \\\"qty\\\": 1, \\\"uom\\\": item_uom, \\\"amount\\\": item.rate  }) %}\\r\\n\\t\\t\\t{% set bill = bill.append(item) %}\\r\\n\\t\\t{% endfor %}\\r\\n\\t\\t\\t\\t\\r\\n \\t\\t<TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\r\\n\\t\\t<COLGROUP>\\r\\n\\t\\t\\t<COL WIDTH=\\\"5%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"10%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"25%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"35%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"5%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"10%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"15%\\\">\\t\\t\\r\\n\\t\\t</COLGROUP>\\r\\n\\t\\t<THEAD style=\\\"background-color: darkgray;\\\">\\r\\n\\t\\t\\t<TR>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Date</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Category</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Description</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Qty</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Rate</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Amount</TH>\\t\\t\\t\\r\\n\\t\\t\\t</TR>\\r\\n\\t\\t</THEAD>\\r\\n\\t\\t{% set total = [0] %}\\r\\n\\t\\t{% for item in bill %}\\r\\n\\t\\t\\t{% set total = total.append(total.pop() + item.amount) %}\\r\\n \\t\\t\\t<TR>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\">{{ loop.index }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\">{{ frappe.utils.get_datetime(item.date).strftime('%d-%b-%Y') }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: left;\\\">{{ item.category }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: left;\\\">{{ item.item_name }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\">{{ item.qty|int }}&nbsp;<small>{{ item.uom }}</small></TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.rate, precision=0) }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.amount, precision=0) }}</TD>\\r\\n\\t\\t\\t</TR>\\r\\n\\t\\t{% endfor %}\\r\\n\\t\\t<TR>\\r\\n\\t\\t\\t<TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\r\\n\\t\\t\\t<TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\r\\n\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=0) }}</TD>\\r\\n\\t\\t\\t\\r\\n\\t\\t</TR> \\r\\n\\t</TABLE>\\r\\n{% endif %}\\t\\t\\r\\n\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% if doc.insurance_company %}\\r\\n\\t{% set bill = [] %}\\r\\n\\t\\t\\r\\n\\t{% set cons_items = frappe.db.get_all(\\\"Healthcare Insurance Claim\\\", {'name': frappe.db.get_value('Patient Encounter', {'appointment' : doc.name, 'is_not_billable' : 0}, 'insurance_claim')}, ['service_item', 'price_list_rate', 'quantity', 'claim_posting_date']) %}\\r\\n\\t{% for item in cons_items %}\\r\\n\\t\\t{% set amount = item.price_list_rate * item.quantity %}\\r\\n\\t\\t{% set category = frappe.db.get_value('Item', item.service_item, 'item_group') %}\\r\\n\\t\\t{% set _ = item.update({\\\"category\\\": category, 'item_amount': amount }) %}\\r\\n\\t\\t{% set bill = bill.append(item) %}\\t\\t\\r\\n\\t{% endfor %}\\r\\n\\r\\n\\t{% set encouter_list = frappe.db.get_all(\\\"Patient Encounter\\\", {'appointment' : doc.name }, ['name']) %}\\r\\n\\t{% set encouter_string =  (encouter_list[:encouter_list|length]|join(\\\",\\\",attribute=\\\"name\\\")) %}\\r\\n\\t{% set claim_list = frappe.db.get_all(\\\"Healthcare Service Order\\\", filters={'order_group': ['in', encouter_string]}, fields=['insurance_claim'], order_by='creation desc') %}\\r\\n\\t{% set claim_string  = (claim_list[:claim_list|length]|join(\\\",\\\",attribute=\\\"insurance_claim\\\")) %}\\r\\n\\t{% set claim_items = frappe.db.get_all(\\\"Healthcare Insurance Claim\\\", filters={'name': ['in', claim_string]}, fields=['name', 'service_item', 'price_list_rate', 'quantity', 'claim_posting_date'], order_by='name asc') %}\\r\\n\\t{% for item in claim_items %}\\r\\n\\t\\t{% set amount = item.price_list_rate * item.quantity %}\\r\\n\\t\\t{% set category = frappe.db.get_value('Item', item.service_item, 'item_group') %}\\r\\n\\t\\t{% set _ = item.update({\\\"category\\\": category, 'item_amount': amount }) %}\\r\\n\\t\\t{% set bill = bill.append(item) %}\\t\\t\\r\\n\\t{% endfor %}\\r\\n\\r\\n\\t{% set inpatient_id = frappe.db.get_value('Patient Encounter', {'appointment' : doc.name}, 'inpatient_record') %}\\r\\n\\t\\r\\n\\t{% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'invoiced': 1, 'parent': inpatient_id}, fields=['check_in', 'service_unit'], order_by='check_in asc') %}    \\r\\n\\t{% for item in bed_charges %}\\r\\n\\t\\t{% set hsu = frappe.db.get_value('Healthcare Service Unit', item.service_unit, 'service_unit_type') %}\\r\\n\\t\\t{% set item_category = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'item_group') %}\\r\\n\\t\\t{% set item_uom = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'uom') %}\\r\\n\\t\\t{% set price_list = frappe.db.get_value('Healthcare Insurance Coverage Plan', {'coverage_plan_name' : doc.coverage_plan_name}, 'price_list') %}\\t\\t\\r\\n\\t\\t{% set price_list_rate = frappe.db.get_value('Item Price', {'item_code' : hsu, 'price_list': price_list}, 'price_list_rate') %}\\r\\n\\t\\t{% set _ = item.update({\\\"service_item\\\": item.service_unit, \\\"claim_posting_date\\\": item.check_in, \\\"category\\\": item_category, \\\"quantity\\\": 1, \\\"price_list_rate\\\": price_list_rate, \\\"uom\\\": item_uom, \\\"item_amount\\\": price_list_rate  }) %}\\r\\n\\t\\t{% set bill = bill.append(item) %}\\r\\n\\t{% endfor %}\\r\\n\\r\\n\\t{% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'parent': inpatient_id}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\r\\n\\t{% for item in ipd_cons %}\\r\\n\\t\\t{% set item_category = frappe.db.get_value('Item', item.consultation_item, 'item_group') %}\\r\\n\\t\\t{% set item_uom = frappe.db.get_value('Item', item.consultation_item, 'stock_uom') %}\\r\\n\\t\\t{% set _ = item.update({\\\"service_item\\\": item.consultation_item, \\\"claim_posting_date\\\": item.date, \\\"category\\\": item_category, \\\"quantity\\\": 1, \\\"price_list_rate\\\": item.rate, \\\"uom\\\": item_uom, \\\"item_amount\\\": item.rate  }) %}\\r\\n\\t\\t{% set bill = bill.append(item) %}\\r\\n\\t{% endfor %}\\r\\n\\r\\n\\t\\r\\n\\t<TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\r\\n\\t\\t<COLGROUP>\\r\\n\\t\\t\\t<COL WIDTH=\\\"5%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"10%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"25%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"35%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"5%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"10%\\\">\\r\\n\\t\\t\\t<COL WIDTH=\\\"15%\\\">\\t\\t\\r\\n\\t\\t</COLGROUP>\\r\\n\\t\\t<THEAD style=\\\"background-color: darkgray;\\\">\\r\\n\\t\\t\\t<TR>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Date</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Category</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Description</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Qty</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Rate</TH>\\r\\n\\t\\t\\t\\t<TH style=\\\"text-align: center;\\\">Amount</TH>\\t\\t\\t\\t\\r\\n\\t\\t\\t</TR>\\r\\n\\t\\t</THEAD>\\r\\n\\t\\t{% set total = [0] %}\\r\\n\\t\\t{% for item in bill %}\\r\\n\\t\\t\\t{% set total = total.append(total.pop() + item.item_amount) %}\\r\\n\\t\\t\\t<TR>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\">{{ loop.index }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\"> {{frappe.utils.get_datetime(item.claim_posting_date).strftime('%d-%b-%Y') }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: left;\\\">{{ item.category }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: left;\\\">{{ item.service_item }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: center;\\\">{{ item.quantity|int }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.price_list_rate, precision=0) }}</TD>\\r\\n\\t\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.item_amount, precision=0) }}</TD>\\r\\n\\t\\t\\t</TR>\\r\\n\\t\\t{% endfor %}\\r\\n\\t\\t<TR>\\r\\n\\t\\t\\t<TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\r\\n\\t\\t\\t<TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\r\\n\\t\\t\\t<TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=0) }}</TD>\\t\\t\\t\\r\\n\\t\\t</TR> \\r\\n\\t</TABLE>\\r\\n{% endif %}\\r\\n\"}]",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2021-04-08 17:08:04.987286",
 "modified_by": "info@aakvatech.com",
 "module": "Hms Tz",
 "name": "Itemized Bill Combined",
 "owner": "info@aakvatech.com",
 "print_format_builder": 1,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}